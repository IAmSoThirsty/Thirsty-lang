version: '3.8'

services:
  # Main Thirsty-lang service
  thirsty:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: thirsty-lang
    volumes:
      - ./examples:/app/examples
      - ./src:/app/src
      - thirsty-data:/app/data
    environment:
      - NODE_ENV=production
      - THIRSTY_VERSION=1.0.0
    ports:
      - "8080:8080"
    command: node src/thirsty-cli.js --help
    restart: unless-stopped
    networks:
      - thirsty-network

  # Development environment
  thirsty-dev:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    container_name: thirsty-lang-dev
    volumes:
      - .:/app
      - node_modules:/app/node_modules
      - thirsty-venv:/app/.venv
    environment:
      - NODE_ENV=development
      - THIRSTY_DEBUG=true
    ports:
      - "8080:8080"
      - "9229:9229"  # Node.js debugging port
    command: npm run repl
    stdin_open: true
    tty: true
    networks:
      - thirsty-network

  # REPL service
  repl:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: thirsty-repl
    volumes:
      - ./examples:/app/examples
    command: npm run repl
    stdin_open: true
    tty: true
    networks:
      - thirsty-network

  # Python REPL service
  python-repl:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: thirsty-python-repl
    volumes:
      - ./examples:/app/examples
      - ./src:/app/src
    command: python3 src/thirsty_repl.py
    stdin_open: true
    tty: true
    networks:
      - thirsty-network

  # Training service
  training:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: thirsty-training
    command: npm run train
    stdin_open: true
    tty: true
    networks:
      - thirsty-network

  # Web playground service
  playground:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: thirsty-playground
    volumes:
      - ./playground:/app/playground
    ports:
      - "8888:8080"
    command: sh -c "cd playground && python3 -m http.server 8080"
    networks:
      - thirsty-network

volumes:
  node_modules:
    driver: local
  thirsty-data:
    driver: local
  thirsty-venv:
    driver: local

networks:
  thirsty-network:
    driver: bridge
